<html>
<head>
    <link rel="stylesheet" type="text/css" href="stylesheets/libs/joyride-1.0.5.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/libs/jquery.fancybox-1.3.4.css"/>
    <link rel="stylesheet" type="text/css" href="stylesheets/libs/jquery-ui-1.9.2.custom.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/all/vishViewer.css">
	<script type="text/javascript" src="javascripts/vishViewer.min.js"></script>
</head>

<body onload="start()" style="display: none" class="loaded" id="presentation_iframe">

	<%= render :partial => 'excursions/vish_viewer_scorm.full' %>

	<script>
		options = {};

		var configuration = {};
		configuration["ImagesPath"] = "images/";
		configuration["StylesheetsPath"] = "stylesheets/";
		configuration["mode"] = "vish";
		options["configuration"] = configuration;

		options["developping"] = false;
		options["scorm"] = true;

		//URL to access to the Recommendation API
		options["recommendationsAPI"] = {
			rootURL: "<%=Vish::Application.config.full_domain%>" + "/excursions/last_slide.json"
		};

		<% if excursion %>
			options["watermarkURL"] = "<%=excursion_url(excursion)%>";
			var presentation = <%= raw excursion.json %>;
		<% elsif json %>
			<% presId = Integer(json["vishMetadata"]["id"]) rescue nil %>
			<% draft = (json["vishMetadata"]["draft"]=="true") rescue true %>
			<% excursion = !presId.nil? ? (Excursion.find_by_id(presId) rescue nil) : nil %>
			<% if !presId.nil? and !draft and !excursion.nil? and excursion.draft == false %>
				options["watermarkURL"] = "<%=excursion_url(excursion)%>";
			<% else %>
				options["watermarkURL"] = "<%=Vish::Application.config.full_domain%>";
			<% end %>
			
			var presentation = <%= raw json.to_json %>;
		<% end %>

		function start(){
			VISH.Viewer.init(options , presentation);
		}
	</script>

</body>
</html>
